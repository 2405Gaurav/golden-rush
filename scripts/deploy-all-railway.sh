#!/bin/bash
# Deploy Both Frontend and Backend to Railway using CLI

echo "ğŸš€ Deploying Full Stack to Railway..."
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

# Check if Railway CLI is installed
if ! command -v railway &> /dev/null; then
    echo "âŒ Railway CLI is not installed. Installing..."
    npm install -g @railway/cli
fi

# Check if user is logged in
echo "ğŸ“‹ Checking Railway authentication..."
if ! railway whoami &> /dev/null; then
    echo "âš ï¸  Not logged in to Railway. Please login:"
    railway login
fi

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "Step 1: Deploying Backend..."
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

cd backend || exit

if [ ! -d ".railway" ]; then
    echo "ğŸ“¦ Initializing Railway project for backend..."
    railway init
fi

echo "ğŸš€ Deploying backend..."
railway up

cd ..

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "Step 2: Deploying Frontend..."
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

if [ ! -d ".railway" ]; then
    echo "ğŸ“¦ Initializing Railway project for frontend..."
    railway init
fi

echo "ğŸš€ Deploying frontend..."
railway up

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âœ… Deployment Complete!"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"

echo ""
echo "ğŸ“Œ Next Steps:"
echo "   1. Get your backend URL from Railway dashboard"
echo "   2. Set frontend environment variable:"
echo "      railway variables"
echo "      Add: NEXT_PUBLIC_API_BASE_URL = <your-backend-url>"
echo "   3. Get your frontend URL from Railway dashboard"
echo "   4. Update backend CORS to include frontend URL:"
echo "      cd backend"
echo "      railway variables"
echo "      Update: CORS_ALLOWED_ORIGINS = <frontend-url>,http://localhost:3000"
echo "   5. Redeploy both services:"
echo "      cd backend && railway up"
echo "      cd .. && railway up"


